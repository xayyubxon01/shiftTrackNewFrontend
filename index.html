<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="src/output.css" rel="stylesheet">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <title>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–º–µ–Ω –∏ –ò—Å—Ç–µ–∫–æ–≤</title>
</head>
<body class="bg-gradient-to-b  from-[#0f172a] via-[#0a0f1e] to-black text-white min-h-screen" >
    <!-- header of site -->
      
      
      <div class="relative overflow-x-auto p-6 	bg-gradient-to-br ">
        <div class=" p-10 flex items-center gap-x-10 h-[150px] shadow-xl  bg-neutral-400/20 backdrop-blur-[1px] border border-neutral-400/20 m-10 rounded-4xl">
            <img src="/uzum-market-seeklogo-6.svg" alt="Logo" class="w-40 h-40 object-contain">
            <h1 class="font-mono text-3xl font-bold text-blue-400 leading-snug ">
              –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–º–µ–Ω –∏ –∑–∞–∫–∞–∑–æ–≤ –≤ —Å—Ç–∞—Ç—É—Å–µ <br> <span class="text-yellow-300">–ò—Å—Ç–µ–∫ –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è</span>
            </h1>
            
          </div>
        <div class="relative overflow-x-auto shadow-xl rounded-2xl bg-white/10 backdrop-blur-md border border-white/10">
          <table class="w-full text-sm text-left text-gray-200">
            <thead class="text-md uppercase  bg-neutral-400/20 backdrop-blur-[1px] border border-neutral-400/20 text-[#cbd5e1]">
              <tr>
                <th scope="col" class="px-6 py-4">–ü–í–ó</th>
                <th scope="col" class="px-6 py-4">–°—Ç–∞—Ç—É—Å</th>
                <th scope="col" class="px-6 py-4">–í—Ä–µ–º—è –æ—Ç–∫—Ä—ã—Ç–∏—è</th>
                <th scope="col" class="px-6 py-4">–û–ø–æ–∑–¥–∞–Ω–∏–µ</th>    
                <th scope="col" class="px-6 py-4">–ò—Å—Ç–µ–∫ —Å—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è</th>
              </tr>
            </thead>
      
            <tbody id="shift-table-body" class="text-lg divide-y divide-white/10">
              <!-- –°—Ç—Ä–æ–∫–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </tbody>
          </table>
        </div>
      
        <div id="output" class="mt-6 text-white text-center"></div>
      </div>
      <div class="flex justify-center p-4 text-center">
        <button id="refresh-btn" class="  flex items-center gap-2 px-10 py-5 text-sm font-medium rounded-md bg-blue-400/30 backdrop-blur-md text-white hover:bg-blue-700 transition hidden">
            <svg id="spinner" class="hidden h-5 w-5 animate-spin" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <circle cx="12" cy="12" r="10" stroke-width="4" stroke="currentColor" stroke-linecap="round" stroke-dasharray="60" stroke-dashoffset="20" />
            </svg>
            –û–±–Ω–æ–≤–∏—Ç—å
          </button>
      </div>
      <div class="text-center">
        <p id="last-updated" class="text-sm text-gray-400 mt-2">‚Äî</p>
    </div>
      <script>
        const output = document.getElementById("output");
    const button = document.getElementById("refresh-btn");
    const tbody = document.getElementById("shift-table-body");
    const updatedAt = document.getElementById("last-updated");

    // ‚úÖ –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    async function loadData() {
      // –ü—Ä—è—á–µ–º –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π
      button.classList.add("hidden");
      const now = new Date();
      updatedAt.textContent = `–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${now.toLocaleTimeString('ru-RU')}`;
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–∞–¥–µ—Ä
      output.innerHTML = `
        <div class="flex items-center justify-center gap-3 text-blue-400 text-lg">
          <svg class="animate-spin h-5 w-5 text-blue-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
          </svg>
          <span>–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ...</span>
        </div>
      `;

      try {
        const res = await fetch("https://shifttracker-1.onrender.com/api/stats");
        if (!res.ok) throw new Error("–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");

        const data = await res.json();

        // –û—á–∏—â–∞–µ–º –≤—ã–≤–æ–¥ –∏ —Ç–∞–±–ª–∏—Ü—É
        output.innerHTML = "";
        tbody.innerHTML = "";

        data.forEach(store => {
          const row = document.createElement("tr");
          row.className = "hover:text-blue-400 transition";

          const delay = store.delayMinutes
            ? `<span class="text-red-600">‚ùå ${store.delayMinutes} –º–∏–Ω</span>` : "‚Äî";

          const shiftStatus = store.shiftStatus === "opened"
            ? "üü¢ –û—Ç–∫—Ä—ã—Ç"
            : store.shiftStatus === "closed"
            ? "üî¥ –ó–∞–∫—Ä—ã—Ç"
            : store.shiftStatus === "error"
            ? "‚ö†Ô∏è –û—à–∏–±–∫–∞"
            : store.shiftStatus ?? "‚Äî";

          row.innerHTML = `
            <td class="px-6 py-4">${store.name}</td>
            <td class="px-6 py-4">${shiftStatus}</td>
            <td class="px-6 py-4">${store.timeOpened ?? "‚Äî"}</td>
            <td class="px-6 py-4">${delay}</td>
            <td class="px-6 py-4 ${store.orderCount > 0 ? 'text-yellow-300 font-bold' : 'text-gray-400'}">
              ${store.orderCount > 0 ? store.orderCount : "‚Äî"}
            </td>
          `;
          tbody.appendChild(row);
        });

        // ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
        button.classList.remove("hidden");

      } catch (err) {
        output.innerHTML = `<p class='text-red-500'>‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${err.message}</p>`;
      }
    }
    

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏
    window.onload = loadData;

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏

    button.addEventListener("click", loadData);
  </script>
      </script>
</body>
</html>
